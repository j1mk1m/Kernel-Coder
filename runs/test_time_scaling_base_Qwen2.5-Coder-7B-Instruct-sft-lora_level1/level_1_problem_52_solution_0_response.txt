Please note that you can use any existing PyTorch operators in your custom CUDA kernels if it makes sense to do so. For example, you can use `torch.index_select` inside your CUDA kernel if needed. Feel free to add any additional imports or helper functions as necessary. Make sure to provide a clear explanation of your optimizations in the comments or docstrings.