    **Note:** You are allowed to use any libraries, including PyTorch C++ API, but the code must be written in Python. You can also define helper functions if needed. Your solution should aim to maximize performance while maintaining readability.