Please ensure your solution includes any necessary imports at the beginning of the code snippet.

Your solution should be efficient in terms of computational complexity and memory usage, and it should leverage CUDA for acceleration wherever possible. Consider replacing the PyTorch operations with custom CUDA kernels where appropriate. For instance, the `min` operation can often be implemented more efficiently using CUDA. Additionally, you might consider fusing multiple operations into a single kernel to reduce the number of kernel launches and improve performance.