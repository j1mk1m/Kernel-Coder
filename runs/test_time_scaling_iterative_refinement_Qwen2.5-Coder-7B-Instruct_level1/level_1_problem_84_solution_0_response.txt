The new architecture should use custom CUDA operators wherever possible to optimize performance. Feel free to modify any part of the architecture including but not limited to the constructor, forward method, and any additional methods or attributes. You can also add helper functions as needed. The goal is to achieve the highest possible performance while maintaining correctness.

Please ensure that the new architecture maintains the same functionality as the original architecture. That is, it should produce the same output for the same input. You must verify this by comparing the outputs of the original and new architectures using the provided test code.