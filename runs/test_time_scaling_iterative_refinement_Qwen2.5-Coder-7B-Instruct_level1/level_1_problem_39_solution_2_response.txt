Please ensure that the code is syntactically correct and can be compiled without errors. If there are any runtime errors, please debug and fix them before submitting the final version of the code. Make sure the new architecture achieves the same functionality as the original architecture while being optimized for performance using custom CUDA kernels.