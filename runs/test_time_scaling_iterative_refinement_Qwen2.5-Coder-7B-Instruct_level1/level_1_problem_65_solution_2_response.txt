Please provide the final working version of the code that meets all requirements.