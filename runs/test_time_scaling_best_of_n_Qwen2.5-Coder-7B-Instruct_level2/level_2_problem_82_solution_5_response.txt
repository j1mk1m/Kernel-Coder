Please include comments in your code explaining what each part does.

### Guidelines:
- Use custom CUDA kernels for any operations that can benefit from parallel computation.
- Consider operator fusion opportunities to combine multiple operations into a single kernel.
- Feel free to change algorithms where appropriate, but aim for simplicity and correctness.
- Ensure the new architecture maintains the same functionality as the original.
```