Your solution should focus on optimizing performance using custom CUDA kernels where appropriate. Feel free to optimize any part of the architecture, but prioritize reducing computational overhead and improving memory access patterns.

```