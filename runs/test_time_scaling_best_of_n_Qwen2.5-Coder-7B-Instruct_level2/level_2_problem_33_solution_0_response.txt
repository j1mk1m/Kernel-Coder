Please ensure the final code has been tested for correctness and performance compared to the original implementation.

Note: You can use any libraries or tools you see fit for the optimization, such as PyTorch extensions, cuBLAS, etc. However, you must implement the core logic yourself using CUDA kernels or equivalent techniques.