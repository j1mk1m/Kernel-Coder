Please provide detailed explanations of your optimization choices and how they improve performance. For example, why did you choose to replace certain operators with custom CUDA kernels, and what were the resulting performance improvements? Feel free to experiment with different optimizations and explain your reasoning behind each choice.

Note: You are not allowed to use any third-party libraries or packages except for PyTorch and its standard extensions. Also, you should avoid using pre-implemented CUDA kernels provided by PyTorch whenever possible.

---

**
