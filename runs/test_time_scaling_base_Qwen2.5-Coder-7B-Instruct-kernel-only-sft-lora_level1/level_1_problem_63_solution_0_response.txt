Please ensure that you explain your choices for replacing certain operations with custom CUDA kernels and any optimizations you made.