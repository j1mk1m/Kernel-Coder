Please provide the final working code after all improvements.
```