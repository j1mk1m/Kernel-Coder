Please ensure that your solution adheres to best practices for CUDA programming, including proper memory management and efficient use of threads and blocks. If necessary, refactor the existing architecture to better suit the requirements of the custom CUDA kernels.