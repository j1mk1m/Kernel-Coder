Please note that I am looking for improvements in both correctness and performance. If there are no obvious errors but the performance could be improved further, please suggest optimizations. 

Also, feel free to experiment with different approaches such as fusing operations, using more efficient algorithms, or exploring alternative ways to implement the same functionality.