Please include comments explaining each part of your solution, especially any performance optimizations or algorithmic changes made. Your code should be as efficient as possible while maintaining correctness.