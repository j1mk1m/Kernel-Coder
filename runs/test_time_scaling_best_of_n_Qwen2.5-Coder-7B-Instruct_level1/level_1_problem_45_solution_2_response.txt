Please provide the full implementation including any necessary imports, function definitions, and class definitions. Make sure all parts of the original architecture are accounted for in the new version.