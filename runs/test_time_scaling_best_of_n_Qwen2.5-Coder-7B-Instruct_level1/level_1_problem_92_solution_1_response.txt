Note: Your solution should be able to handle large batch sizes efficiently.