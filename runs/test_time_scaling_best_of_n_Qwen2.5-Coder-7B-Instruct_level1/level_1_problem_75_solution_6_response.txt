Please note that the CUDA code should be efficient and take advantage of parallelism. It should also handle edge cases such as variable batch sizes and different input dimensions. Your solution should be optimized for performance, but readability and maintainability should also be considered. 

Finally, please provide a brief explanation of why you chose to optimize certain operators and how the custom CUDA kernels improve performance compared to the original PyTorch operators.