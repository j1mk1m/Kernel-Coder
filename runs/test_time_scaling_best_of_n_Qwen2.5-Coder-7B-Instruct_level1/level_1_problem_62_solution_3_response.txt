Please note that the goal here is to optimize performance through custom CUDA kernels, so please focus on optimizing the specific operations that would benefit most from such an approach, rather than trying to optimize everything. Feel free to combine operations or change algorithms if it makes sense to do so for performance reasons.